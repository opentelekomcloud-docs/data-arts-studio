:original_name: CreateCluster.html

.. _CreateCluster:

Creating a Cluster
==================

Function
--------

This API is used to create a cluster.

URI
---

POST /v1.1/{project_id}/clusters

.. table:: **Table 1** Path Parameters

   ========== ========= ====== ===========
   Parameter  Mandatory Type   Description
   ========== ========= ====== ===========
   project_id Yes       String Project ID
   ========== ========= ====== ===========

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +--------------+-----------+--------+----------------------------------------------------------------------------------------------------------+
   | Parameter    | Mandatory | Type   | Description                                                                                              |
   +==============+===========+========+==========================================================================================================+
   | X-Auth-Token | Yes       | String | User token. It can be obtained by calling the IAM API (value of X-Subject-Token in the response header). |
   +--------------+-----------+--------+----------------------------------------------------------------------------------------------------------+
   | X-Language   | Yes       | String | Request language                                                                                         |
   +--------------+-----------+--------+----------------------------------------------------------------------------------------------------------+

.. table:: **Table 3** Request body parameters

   +-------------+-----------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Mandatory | Type                                                   | Description                                                                                                                                                                                                                                       |
   +=============+===========+========================================================+===================================================================================================================================================================================================================================================+
   | cluster     | Yes       | :ref:`cluster <createcluster__request_cluster>` object | Cluster object. For details, see the descriptions of **cluster** parameters.                                                                                                                                                                      |
   +-------------+-----------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | auto_remind | No        | Boolean                                                | Whether to enable message notification. If you enable this function, you can configure a maximum of five mobile numbers or email addresses. You will be notified of table/file migration job failures and EIP exceptions by SMS message or email. |
   +-------------+-----------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | phone_num   | No        | String                                                 | Mobile number for receiving notifications                                                                                                                                                                                                         |
   +-------------+-----------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | email       | No        | String                                                 | Email address for receiving notifications                                                                                                                                                                                                         |
   +-------------+-----------+--------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _createcluster__request_cluster:

.. table:: **Table 4** cluster

   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter           | Mandatory | Type                                                                         | Description                                                                                                                                                                                                                                                                                                                                      |
   +=====================+===========+==============================================================================+==================================================================================================================================================================================================================================================================================================================================================+
   | scheduleBootTime    | No        | String                                                                       | Time for scheduled startup of a CDM cluster. The CDM cluster starts at this time every day.                                                                                                                                                                                                                                                      |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | isScheduleBootOff   | No        | Boolean                                                                      | Whether to enable scheduled startup/shutdown. The scheduled startup/shutdown and auto shutdown functions cannot be enabled at the same time.                                                                                                                                                                                                     |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | instances           | No        | Array of :ref:`instance <createcluster__request_instance>` objects           | Node list. For details, see the descriptions of **instances** parameters.                                                                                                                                                                                                                                                                        |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | datastore           | No        | :ref:`Datastore <createcluster__request_datastore>` object                   | Cluster information. For details, see the descriptions of **datastore** parameters.                                                                                                                                                                                                                                                              |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | extended_properties | No        | :ref:`ExtendedProperties <createcluster__request_extendedproperties>` object | Extended attribute. For details, see parameters in the extended_properties field.                                                                                                                                                                                                                                                                |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | scheduleOffTime     | No        | String                                                                       | Time for scheduled shutdown of a CDM cluster. The CDM cluster shuts down directly at this time every day without waiting for unfinished jobs to complete.                                                                                                                                                                                        |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | vpcId               | No        | String                                                                       | VPC ID, which is used for configuring a network for the cluster.                                                                                                                                                                                                                                                                                 |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | name                | No        | String                                                                       | Cluster name                                                                                                                                                                                                                                                                                                                                     |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | sys_tags            | No        | Array of :ref:`sys_tags <createcluster__request_sys_tags>` objects           | Enterprise project information. For details, see the descriptions of **sys_tags** parameters.                                                                                                                                                                                                                                                    |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | isAutoOff           | No        | Boolean                                                                      | Whether to enable auto shutdown. The auto shutdown and scheduled startup/shutdown functions cannot be enabled at the same time. When auto shutdown is enabled, if no job is running in the cluster and no scheduled job is available, a cluster will be automatically shut down 15 minutes after it starts running, which reduces costs for you. |
   +---------------------+-----------+------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _createcluster__request_instance:

.. table:: **Table 5** instance

   +-------------------+-----------------+------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter         | Mandatory       | Type                                                       | Description                                                                                                                                                                           |
   +===================+=================+============================================================+=======================================================================================================================================================================================+
   | availability_zone | Yes             | String                                                     | AZ where a cluster is located                                                                                                                                                         |
   +-------------------+-----------------+------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | nics              | Yes             | Array of :ref:`nics <createcluster__request_nics>` objects | NIC list. A maximum of two NICs are supported. For details, see the descriptions of **nics** parameters.                                                                              |
   +-------------------+-----------------+------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | flavorRef         | Yes             | String                                                     | Instance flavor                                                                                                                                                                       |
   |                   |                 |                                                            |                                                                                                                                                                                       |
   |                   |                 |                                                            | -  **a79fd5ae-1833-448a-88e8-3ea2b913e1f6**: cdm.small with 2 vCPUs and 4 GB memory applicable to Proof of Concept (PoC) verification and development and tests                       |
   |                   |                 |                                                            | -  **fb8fe666-6734-4b11-bc6c-43d11db3c745**: cdm.medium with 4 vCPUs and 8 GB memory applicable to the migration of a single database table with fewer than 10 million pieces of data |
   |                   |                 |                                                            | -  **5ddb1071-c5d7-40e0-a874-8a032e81a697**: cdm.large with 8 vCPUs and 16 GB memory applicable to the migration of a single database table with 10 million or more pieces of data    |
   |                   |                 |                                                            | -  **6ddb1072-c5d7-40e0-a874-8a032e81a698**: cdm.xlarge with 16 vCPUs and 32 GB memory applicable to the migration of terabytes of data requiring 10GE bandwidth                      |
   +-------------------+-----------------+------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | type              | Yes             | String                                                     | Node type. Currently, only **cdm** is available.                                                                                                                                      |
   +-------------------+-----------------+------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _createcluster__request_nics:

.. table:: **Table 6** nics

   =============== ========= ====== =================
   Parameter       Mandatory Type   Description
   =============== ========= ====== =================
   securityGroupId Yes       String Security group ID
   net-id          Yes       String Subnet ID
   =============== ========= ====== =================

.. _createcluster__request_datastore:

.. table:: **Table 7** Datastore

   ========= ========= ====== ======================================
   Parameter Mandatory Type   Description
   ========= ========= ====== ======================================
   type      No        String Type. Generally, the value is **cdm**.
   version   No        String Cluster version
   ========= ========= ====== ======================================

.. _createcluster__request_extendedproperties:

.. table:: **Table 8** ExtendedProperties

   =========== ========= ====== ======================================
   Parameter   Mandatory Type   Description
   =========== ========= ====== ======================================
   workSpaceId No        String Workspace ID
   resourceId  No        String Resource ID
   trial       No        String Whether the cluster is a trial cluster
   =========== ========= ====== ======================================

.. _createcluster__request_sys_tags:

.. table:: **Table 9** sys_tags

   +-----------+-----------+--------+--------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                            |
   +===========+===========+========+========================================================+
   | value     | Yes       | String | Enterprise project ID                                  |
   +-----------+-----------+--------+--------------------------------------------------------+
   | key       | Yes       | String | The value is fixed at **\_sys_enterprise_project_id**. |
   +-----------+-----------+--------+--------------------------------------------------------+

Response Parameters
-------------------

**Status code: 202**

.. table:: **Table 10** Response body parameters

   +-----------+-----------------------------------------------------------------------------------+--------------------------+
   | Parameter | Type                                                                              | Description              |
   +===========+===================================================================================+==========================+
   | name      | String                                                                            | Cluster name             |
   +-----------+-----------------------------------------------------------------------------------+--------------------------+
   | id        | String                                                                            | Cluster ID               |
   +-----------+-----------------------------------------------------------------------------------+--------------------------+
   | task      | :ref:`Task <createcluster__response_task>` object                                 | Task information         |
   +-----------+-----------------------------------------------------------------------------------+--------------------------+
   | datastore | :ref:`Datastore <createcluster__response_datastore>` object                       | Cluster information      |
   +-----------+-----------------------------------------------------------------------------------+--------------------------+
   | instances | Array of :ref:`ClusterInstance <createcluster__response_clusterinstance>` objects | Cluster node information |
   +-----------+-----------------------------------------------------------------------------------+--------------------------+

.. _createcluster__response_task:

.. table:: **Table 11** Task

   ========= ====== ===========
   Parameter Type   Description
   ========= ====== ===========
   id        String Task ID
   name      String Task name
   ========= ====== ===========

.. _createcluster__response_datastore:

.. table:: **Table 12** Datastore

   ========= ====== ======================================
   Parameter Type   Description
   ========= ====== ======================================
   type      String Type. Generally, the value is **cdm**.
   version   String Cluster version
   ========= ====== ======================================

.. _createcluster__response_clusterinstance:

.. table:: **Table 13** ClusterInstance

   ========= ====== ================================================
   Parameter Type   Description
   ========= ====== ================================================
   id        String Node VM ID
   name      String Name of the VM on the node
   type      String Node type. Currently, only **cdm** is available.
   shard_id  String Shard ID
   ========= ====== ================================================

Example Requests
----------------

.. code-block:: text

   POST /v1.1/1551c7f6c808414d8e9f3c514a170f2e/clusters

   {
     "cluster" : {
       "scheduleBootTime" : "",
       "isScheduleBootOff" : false,
       "instances" : [ {
         "availability_zone" : "eu-de",
         "nics" : [ {
           "securityGroupId" : "c37852d2-2d12-41cb-af47-65c80e995c80",
           "net-id" : "2d120298-6130-44d4-a438-454912fff901"
         } ],
         "flavorRef" : "5ddb1071-c5d7-40e0-a874-8a032e81a697",
         "type" : "cdm"
       } ],
       "datastore" : {
         "type" : "cdm",
         "version" : "1.8.10"
       },
       "scheduleOffTime" : "",
       "vpcId" : "67c06084-2212-4242-bcd4-d2144c2385a9",
       "name" : "cdm-ab82",
       "sys_tags" : [ {
         "value" : "1ce45885-4033-40d2-bdde-d4dbaceb387d",
         "key" : "_sys_enterprise_project_id"
       } ],
       "isAutoOff" : false
     },
     "auto_remind" : false,
     "phone_num" : "",
     "email" : ""
   }

Example Responses
-----------------

**Status code: 202**

Accepted

.. code-block::

   {
     "id" : "befc862c-9286-46a0-a1d6-300d98b63aad",
     "name" : "cdm-4ef213",
     "task" : {
       "id" : "2c9080047f1b1185017f1ef6ad0500ac",
       "name" : "rdsCreateBackupJob"
     },
     "datastore" : {
       "type" : "cdm",
       "version" : "2.9.1.100"
     },
     "instances" : [ {
       "id" : "b2672e7d-2faf-423f-96bb-0664cd743cfd",
       "name" : "cdm-4ef213-cdm-dn-1-1",
       "type" : "cdm",
       "shard_id" : "dn-1"
     } ]
   }

Status Codes
------------

+-------------+-----------------------------------------------------------------+
| Status Code | Description                                                     |
+=============+=================================================================+
| 202         | Accepted                                                        |
+-------------+-----------------------------------------------------------------+
| 400         | Request error.                                                  |
+-------------+-----------------------------------------------------------------+
| 401         | Authentication failed.                                          |
+-------------+-----------------------------------------------------------------+
| 403         | You do not have required permissions to perform this operation. |
+-------------+-----------------------------------------------------------------+
| 404         | The requested resource was not found.                           |
+-------------+-----------------------------------------------------------------+
| 500         | Internal service error.                                         |
+-------------+-----------------------------------------------------------------+
| 503         | Service unavailable.                                            |
+-------------+-----------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <errorcode>`.
