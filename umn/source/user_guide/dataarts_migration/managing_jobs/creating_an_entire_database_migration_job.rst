:original_name: dataartsstudio_01_0075.html

.. _dataartsstudio_01_0075:

Creating an Entire Database Migration Job
=========================================

Scenario
--------

CDM supports entire DB migration between homogeneous and heterogeneous data sources. The migration principles are the same as those in :ref:`Table/File Migration Jobs <dataartsstudio_01_0046>`. Each type of Elasticsearch, each key prefix of Redis, or each collection of MongoDB can be executed concurrently as a subtask.

:ref:`Supported Data Sources in Entire DB Migration <dataartsstudio_01_0014__en-us_topic_0000001147970137_en-us_topic_0108275392_section2459343715638>` lists the data sources supporting entire database migration.

Field Mapping in Automatic Table Creation
-----------------------------------------

CDM automatically creates tables at the destination during database migration. :ref:`Figure 1 <dataartsstudio_01_0075__en-us_topic_0108275370_en-us_topic_0108275392_fig662181513539>` describes the field mapping between the DWS tables created by CDM and source tables. For example, if you use CDM to migrate the Oracle database to DWS, CDM automatically creates a table on DWS and maps the **NUMBER(3,0)** field of the Oracle database to the **SMALLINT** field of DWS.

.. _dataartsstudio_01_0075__en-us_topic_0108275370_en-us_topic_0108275392_fig662181513539:

.. figure:: /_static/images/en-us_image_0000001373408261.png
   :alt: **Figure 1** Field mapping in automatic table creation on DWS

   **Figure 1** Field mapping in automatic table creation on DWS

Prerequisites
-------------

-  You have created links according to :ref:`Creating Links <dataartsstudio_01_0024>`.
-  The CDM cluster can communicate with the data source.

Procedure
---------

#. Log in to the management console and choose **Service List** > **Cloud Data Migration**. In the left navigation pane, choose **Cluster Management**. Locate the target cluster and click **Job Management**.

#. Choose **Entire DB Migration** > **Create Job**. The page for configuring the job is displayed.

#. Configure the related parameters of the source database according to :ref:`Table 1 <dataartsstudio_01_0075__en-us_topic_0108275370_table14973632102118>`.

   .. _dataartsstudio_01_0075__en-us_topic_0108275370_table14973632102118:

   .. table:: **Table 1** Parameter description

      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      | Source Database        | Parameter                | Description                                                                                                                                                                                                                                                                                                    | Example Value          |
      +========================+==========================+================================================================================================================================================================================================================================================================================================================+========================+
      | -  DWS                 | Schema/Tablespace        | Name of the schema or tablespace from which data will be extracted. This parameter is displayed when **Use SQL Statement** is set to **No**. Click the icon next to the text box to go to the page for selecting a schema or directly enter a schema or tablespace.                                            | schema                 |
      | -  FusionInsight LibrA |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  MySQL               |                          | If the desired schema or tablespace is not displayed, check whether the login account has the permissions required to query metadata.                                                                                                                                                                          |                        |
      | -  PostgreSQL          |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  SQL Server          |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  Oracle              |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  IBM Db2             |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  SAP HANA            |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  MyCAT               |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | -  Dameng database     |                          |                                                                                                                                                                                                                                                                                                                |                        |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      |                        | WHERE Clause             | WHERE clause used to specify the tables to be extracted. This parameter applies to all subtables in the entire DB migration. If this parameter is not set, the entire table is extracted. If the table to be migrated does not contain the fields specified by the WHERE clause, the migration will fail.      | age > 18 and age <= 60 |
      |                        |                          |                                                                                                                                                                                                                                                                                                                |                        |
      |                        |                          | You can set a date macro variable to extract data generated on a specific date.                                                                                                                                                                                                                                |                        |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      |                        | Null in Partition Column | Whether a partition field can be null                                                                                                                                                                                                                                                                          | Yes                    |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      | Hive                   | Database Name            | Name of the database to be migrated. The user configured in the source link must have the permission to read the database.                                                                                                                                                                                     | hivedb                 |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      | HBase                  | Start Time               | Start time (included). The format is *yyyy-MM-dd hh:mm:ss*. The dateformat time macro variable function is supported. Examples: **2017-12-31 20:00:00**, **${dateformat(yyyy-MM-dd, -1, DAY)} 02:00:00**, and **${dateformat(yyyy-MM-dd HH:mm:ss, -1, DAY)}**                                                  | ``-``                  |
      |                        |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | CloudTable             |                          |                                                                                                                                                                                                                                                                                                                |                        |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      |                        | End Time                 | End time (excluded) The format is *yyyy-MM-dd hh:mm:ss*. The dateformat time macro variable function is supported. Examples: **2018-01-01 20:00:00**, **${dateformat(yyyy-MM-dd, -1, DAY)} 02:00:00**, and **${dateformat(yyyy-MM-dd HH:mm:ss, -1, DAY)}**                                                     | ``-``                  |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      | Redis                  | Key Filter Character     | Filter character used to determine the keys to be migrated For example, if the value of this parameter is **a\***, all asterisks (``*``) will be migrated.                                                                                                                                                     | ``-``                  |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      | DDS                    | Database Name            | Name of the database from which data is to be migrated. The user configured in the source link must have the permission to read the database.                                                                                                                                                                  | mongodb                |
      |                        |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | MongoDB                |                          |                                                                                                                                                                                                                                                                                                                |                        |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      |                        | Query Filter             | Filter used to match documents. Example: **{HTTPStatusCode:{$gt:"400",$lt:"500"},HTTPMethod:"GET"}**                                                                                                                                                                                                           | ``-``                  |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+
      | Elasticsearch          | Index                    | Index of the data to be extracted. The value can be a wildcard character. Multiple indexes that meet the wildcard condition can be migrated at a time. For example, if this parameter is set to **cdm\***, CDM migrates all indexes starting with **cdm**, such as **cdm01**, **cdmB3**, **cdm_45** and so on. | cdm\*                  |
      |                        |                          |                                                                                                                                                                                                                                                                                                                |                        |
      | CSS                    |                          | If multiple indexes are migrated at the same time, **Index** cannot be configured at the migration destination.                                                                                                                                                                                                |                        |
      +------------------------+--------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------+

#. Configure the related parameters, from :ref:`Table 2 <dataartsstudio_01_0075__en-us_topic_0108275370_table17764626124115>`, for the destination cloud service.

   .. _dataartsstudio_01_0075__en-us_topic_0108275370_table17764626124115:

   .. table:: **Table 2** Destination job parameters

      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | Source Database        | Parameter          | Description                                                                                                                                                                                                                                                                                                    | Example Value   |
      +========================+====================+================================================================================================================================================================================================================================================================================================================+=================+
      | -  DWS                 | ``-``              | For details about the destination job parameters required for entire DB migration to a relational database, see :ref:`To a Common Relational Database <dataartsstudio_01_0068>`.                                                                                                                               | schema          |
      | -  FusionInsight LibrA |                    |                                                                                                                                                                                                                                                                                                                |                 |
      | -  MySQL               |                    |                                                                                                                                                                                                                                                                                                                |                 |
      | -  PostgreSQL          |                    |                                                                                                                                                                                                                                                                                                                |                 |
      | -  SQL Server          |                    |                                                                                                                                                                                                                                                                                                                |                 |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | MRS HIVE               | ``-``              | For details about the destination job parameters required for entire DB migration to MRS HIVE, see :ref:`To Hive <dataartsstudio_01_0066>`.                                                                                                                                                                    | hivedb          |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | MRS HBase              | ``-``              | For details about the destination job parameters required for entire DB migration to MRS HBase or CloudTable, see :ref:`To HBase/CloudTable <dataartsstudio_01_0064>`.                                                                                                                                         | Yes             |
      |                        |                    |                                                                                                                                                                                                                                                                                                                |                 |
      | CloudTable             |                    |                                                                                                                                                                                                                                                                                                                |                 |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | MRS HDFS               | ``-``              | For details about the destination job parameters required for entire DB migration to MRS HDFS, see :ref:`To HDFS <dataartsstudio_01_0063>`.                                                                                                                                                                    | ``-``           |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | OBS                    | ``-``              | For details about the destination job parameters required for entire database migration to OBS, see :ref:`To OBS <dataartsstudio_01_0062>`.                                                                                                                                                                    | ``-``           |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | DCS                    | ``-``              | For details about the destination job parameters required for entire database migration to DCS, see :ref:`To DCS <dataartsstudio_01_0070>`.                                                                                                                                                                    | ``-``           |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | DDS                    | Database Name      | Name of the database from which data is to be migrated. The user configured in the source link must have the permission to read the database.                                                                                                                                                                  | mongodb         |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      |                        | Migration Behavior | Add                                                                                                                                                                                                                                                                                                            | ``-``           |
      |                        |                    |                                                                                                                                                                                                                                                                                                                |                 |
      |                        |                    | If there is already a value, replace it; otherwise, add a value.                                                                                                                                                                                                                                               |                 |
      |                        |                    |                                                                                                                                                                                                                                                                                                                |                 |
      |                        |                    | Replace                                                                                                                                                                                                                                                                                                        |                 |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+
      | CSS                    | Index              | Index of the data to be extracted. The value can be a wildcard character. Multiple indexes that meet the wildcard condition can be migrated at a time. For example, if this parameter is set to **cdm\***, CDM migrates all indexes starting with **cdm**, such as **cdm01**, **cdmB3**, **cdm_45** and so on. | cdm\*           |
      |                        |                    |                                                                                                                                                                                                                                                                                                                |                 |
      |                        |                    | If multiple indexes are migrated at the same time, **Index** cannot be configured at the migration destination.                                                                                                                                                                                                |                 |
      +------------------------+--------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+

#. If a relational database is migrated, after job parameters are configured, click **Next** to access the page for selecting tables. You can select the tables to be migrated to the migration destination based on your requirements.

#. Click **Next** and set job parameters.


   .. figure:: /_static/images/en-us_image_0000001373088069.png
      :alt: **Figure 2** Task parameters

      **Figure 2** Task parameters

   :ref:`Table 3 <dataartsstudio_01_0075__en-us_topic_0108275370_en-us_topic_0108275458_table62790900104257>` describes related parameters.

   .. _dataartsstudio_01_0075__en-us_topic_0108275370_en-us_topic_0108275458_table62790900104257:

   .. table:: **Table 3** Task configuration parameters

      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Parameter                            | Description                                                                                                                                                                                                                                                                                                          | Example Value         |
      +======================================+======================================================================================================================================================================================================================================================================================================================+=======================+
      | Concurrent Tables                    | Number of tables to be concurrently executed                                                                                                                                                                                                                                                                         | 3                     |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Concurrent Extractors                | Number of extractors to be concurrently executed. Generally, retain the default value.                                                                                                                                                                                                                               | 1                     |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Write Dirty Data                     | Whether to record dirty data. By default, this parameter is set to **No**.                                                                                                                                                                                                                                           | Yes                   |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Write Dirty Data Link                | This parameter is only displayed when **Write Dirty Data** is set to **Yes**.                                                                                                                                                                                                                                        | obs_link              |
      |                                      |                                                                                                                                                                                                                                                                                                                      |                       |
      |                                      | Only links to OBS support dirty data writes.                                                                                                                                                                                                                                                                         |                       |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | OBS Bucket                           | This parameter is only displayed when **Write Dirty Data Link** is a link to OBS.                                                                                                                                                                                                                                    | dirtydata             |
      |                                      |                                                                                                                                                                                                                                                                                                                      |                       |
      |                                      | Name of the OBS bucket to which the dirty data will be written.                                                                                                                                                                                                                                                      |                       |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Dirty Data Directory                 | This parameter is only displayed when **Write Dirty Data** is set to **Yes**.                                                                                                                                                                                                                                        | /user/dirtydir        |
      |                                      |                                                                                                                                                                                                                                                                                                                      |                       |
      |                                      | Directory for storing dirty data on OBS. Dirty data is saved only when this parameter is configured.                                                                                                                                                                                                                 |                       |
      |                                      |                                                                                                                                                                                                                                                                                                                      |                       |
      |                                      | You can go to this directory to query data that fails to be processed or is filtered out during job execution, and check the source data that does not meet conversion or cleaning rules.                                                                                                                            |                       |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Max. Error Records in a Single Shard | This parameter is only displayed when **Write Dirty Data** is set to **Yes**.                                                                                                                                                                                                                                        | 0                     |
      |                                      |                                                                                                                                                                                                                                                                                                                      |                       |
      |                                      | When the number of error records of a single map exceeds the upper limit, the job will automatically terminate and the imported data cannot be rolled back. You are advised to use a temporary table as the destination table. After the data is imported, rename the table or combine it into the final data table. |                       |
      +--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+

#. Click **Save** or **Save and Run**.

   When the job starts running, a sub-job will be generated for each table. You can click the job name to view the sub-job list.
